<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Menú GAD V4 - Elite Cyber</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* FONDO Y ESTRUCTURA DE SCROLL */
        body { 
            font-family: 'Orbitron', sans-serif; 
            background: #000; 
            color: #fff;
            margin: 0; padding: 0; 
            height: 100vh; display: flex; flex-direction: column; 
            overflow: hidden; 
            visibility: hidden; 
        }
        body.loaded { visibility: visible; }

        #main-scroll-area {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding-bottom: 60px; /* Espacio para que el menú de admin no se corte */
        }

        /* CABECERA VIGIA */
        #header-vigia-container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            cursor: pointer;
            border-bottom: 3px solid #00f0ff;
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.4);
        }
        #header-vigia-img { width: 100%; height: auto; display: block; }

        @media (max-width: 640px) {
            #header-vigia-container { height: 160px; overflow: hidden; }
            #header-vigia-img { height: 100%; object-fit: cover; }
        }

        .main-content-wrapper { width: 100%; max-width: 600px; margin: 0 auto; padding: 10px; }
        .title-container h1 { font-size: 1.8rem; text-align: center; margin: 15px 0; text-shadow: 0 0 10px #00f0ff; }

        /* --- BOTONES ESTILO PLACA TECNOLÓGICA (IGUAL A LA IMAGEN) --- */
        #main-menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .menu-button-container.col-span-2 { grid-column: span 2; }

        .cyber-button {
            position: relative;
            width: 100%;
            min-height: 90px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 10px 20px;
            font-size: 0.9rem;
            font-weight: 900;
            text-transform: uppercase;
            color: #fff;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            
            /* FORMA Y BORDES */
            background: rgba(10, 10, 15, 0.95);
            border: 2px solid #00f0ff;
            clip-path: polygon(15% 0, 85% 0, 100% 25%, 100% 75%, 85% 100%, 15% 100%, 0 75%, 0 25%);
            
            /* TEXTURA DE CIRCUITOS */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'%3E%3Cg fill='%2300f0ff' fill-opacity='0.1'%3E%3Cpath d='M0 0h1v1H0zm2 0h1v1H2zm2 0h1v1H4zm1 1h1v1H5zm1 1h1v1H6z'/%3E%3C/g%3E%3C/svg%3E");
            box-shadow: inset 0 0 15px rgba(0, 240, 255, 0.3);
        }

        /* EL RAYO AZUL BRILLANTE CENTRAL */
        .cyber-button::before {
            content: '';
            position: absolute;
            top: 50%; left: 10%; width: 80%; height: 2px;
            background: #fff;
            box-shadow: 0 0 15px 3px #00f0ff, 0 0 5px 1px #fff;
            opacity: 0.8;
            pointer-events: none;
        }

        /* VARIANTES DE COLOR */
        .cyber-button.success { border-color: #00ff9d; box-shadow: inset 0 0 15px rgba(0, 255, 157, 0.3); }
        .cyber-button.success::before { box-shadow: 0 0 15px 3px #00ff9d, 0 0 5px 1px #fff; }

        .cyber-button.alert { border-color: #ff3366; box-shadow: inset 0 0 15px rgba(255, 51, 102, 0.3); }
        .cyber-button.alert::before { box-shadow: 0 0 15px 3px #ff3366, 0 0 5px 1px #fff; }

        .cyber-button.warning { border-color: #ffcc00; box-shadow: inset 0 0 15px rgba(255, 204, 0, 0.3); }
        .cyber-button.warning::before { box-shadow: 0 0 15px 3px #ffcc00, 0 0 5px 1px #fff; }

        .cyber-button:hover {
            transform: scale(1.04);
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.6);
            background-color: rgba(0, 240, 255, 0.1);
        }

        /* MENÚ ADMINISTRADOR */
        #admin-toggle-btn { 
            background: #111; color: #888; border: 1px solid #333; 
            padding: 12px; width: 100%; margin-top: 30px; cursor: pointer; 
            font-family: 'Orbitron'; font-size: 0.8rem;
        }
        .controls-container { 
            background: #080808; border: 1px solid #333; padding: 15px; 
            margin-top: 10px; display: none; flex-direction: column; gap: 10px; 
        }

        /* SIDEBAR (MENÚ HAMBURGUESA RECUPERADO) */
        #sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; z-index: 9998; }
        #sidebar-menu { 
            position: fixed; top: 0; left: 0; height: 100%; width: 280px; 
            background: #050505; border-right: 2px solid #00f0ff; 
            z-index: 9999; transform: translateX(-100%); transition: 0.3s; 
            display: flex; flex-direction: column; 
        }
        .sidebar-header { padding: 20px; border-bottom: 1px solid #333; color: #00f0ff; display: flex; justify-content: space-between; align-items: center; }
        .sidebar-footer-btn { margin-top: auto; padding: 20px; background: #000; border-top: 1px solid #333; }
        #sidebar-back-btn { width: 100%; padding: 12px; background: rgba(220, 38, 38, 0.2); border: 1px solid #ff3366; color: #ff3366; font-weight: bold; cursor: pointer; font-family: 'Orbitron'; }
    </style>
</head>
<body>

<div id="main-scroll-area">
    <div id="header-vigia-container">
        <img src="logovigia.jpg" alt="Cabecera VigIA" id="header-vigia-img">
    </div>

    <div class="main-content-wrapper">
        <div class="title-container">
            <h1 id="main-title-text">SISTEMA GAD</h1>
        </div>
        
        <div id="user-info-display" style="text-align:center; font-size:0.7rem; color:#666; margin-bottom:10px;"></div>

        <div id="main-menu-grid"></div>

        <button id="admin-toggle-btn"><i class="fas fa-terminal"></i> CONSOLA DE ADMINISTRADOR</button>
        <div class="controls-container" id="admin-panel">
            <div id="counters-row"></div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button id="show-edit-menu-modal" class="cyber-button warning" style="min-height:50px;">EDITAR</button>
                <button id="backup-button" class="cyber-button success" style="min-height:50px;" onclick="window.open('COPIA SEGURIDAD FIREBASE.html')">BACKUP</button>
            </div>
            <button id="btn-logout" class="cyber-button alert" style="min-height:50px; margin-top:10px;">DESCONECTAR</button>
        </div>
    </div>
</div>

<div id="iframe-viewer-area" style="display:none; width:100%; height:100vh;">
    <iframe id="content-iframe" style="width:100%; height:100%; border:none;"></iframe>
</div>

<div id="sidebar-overlay"></div>
<div id="sidebar-menu">
     <div class="sidebar-header">
         <h2>NAVEGACIÓN</h2>
         <button id="close-sidebar" style="background:none; border:none; color:#fff; font-size:1.5rem; cursor:pointer;"><i class="fas fa-times"></i></button>
     </div>
     <div id="sidebar-tree-container" style="flex-grow:1; overflow-y:auto;"></div>
     <div class="sidebar-footer-btn">
         <button id="sidebar-back-btn" style="display:none;">VOLVER ATRÁS</button>
     </div>
</div>

<script>
  const firebaseConfig = {
      apiKey: "AIzaSyCY8V_P7m8lZUvGbMVlGaa-GVhbmyikmag",
      authDomain: "gad-alicante-v4.firebaseapp.com",
      databaseURL: "https://gad-alicante-v4-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "gad-alicante-v4",
      storageBucket: "gad-alicante-v4.firebasestorage.app",
      messagingSenderId: "119727545224",
      appId: "1:119727545224:web:36880c50d196c456cdb83d"
  };
  
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const auth = firebase.auth();

  let currentMenuPath = [];
  let menuButtonsData = {};

  // LÓGICA DE APERTURA DEL MENÚ HAMBURGUESA
  const openSidebar = () => { 
      document.getElementById('sidebar-menu').style.transform = "translateX(0)"; 
      document.getElementById('sidebar-overlay').style.display = "block"; 
  }
  const closeSidebar = () => { 
      document.getElementById('sidebar-menu').style.transform = "translateX(-100%)"; 
      document.getElementById('sidebar-overlay').style.display = "none"; 
  }
  
  document.getElementById('header-vigia-container').onclick = openSidebar;
  document.getElementById('close-sidebar').onclick = closeSidebar;
  document.getElementById('sidebar-overlay').onclick = closeSidebar;

  db.ref('menuButtons').on('value', s => { 
      menuButtonsData = s.val() || {}; 
      renderMenuButtons(); 
      document.body.classList.add('loaded');
  });

  function renderMenuButtons() {
      const grid = document.getElementById('main-menu-grid');
      grid.innerHTML = '';
      const parentId = currentMenuPath.length > 0 ? currentMenuPath[currentMenuPath.length - 1] : null;
      
      const buttons = Object.entries(menuButtonsData)
          .filter(([k, v]) => v.parent == parentId)
          .sort((a,b) => a[1].order - b[1].order);

      buttons.forEach(([k, v]) => {
          const btn = document.createElement('div');
          btn.className = `cyber-button ${v.size === 'full-width' ? 'col-span-2' : ''}`;
          
          if (v.color === '#dc2626') btn.classList.add('alert');
          if (v.color === '#16a34a') btn.classList.add('success');
          if (v.color === '#f59e0b') btn.classList.add('warning');

          btn.innerHTML = `<span>${v.text}</span>`;
          btn.onclick = () => {
              if (v.type === 'parent') {
                  currentMenuPath.push(k);
                  renderMenuButtons();
              } else {
                  showIframe(v);
              }
          };
          grid.appendChild(btn);
      });
      document.getElementById('sidebar-back-btn').style.display = (currentMenuPath.length > 0) ? 'block' : 'none';
  }

  function showIframe(data) {
      document.getElementById('main-scroll-area').style.display = 'none';
      document.getElementById('iframe-viewer-area').style.display = 'block';
      const ifr = document.getElementById('content-iframe');
      if (data.htmlCode) {
          const doc = ifr.contentWindow.document;
          doc.open(); doc.write(data.htmlCode); doc.close();
      } else { ifr.src = data.href; }
  }

  document.getElementById('sidebar-back-btn').onclick = () => {
      currentMenuPath.pop();
      renderMenuButtons();
      closeSidebar();
  };

  document.getElementById('admin-toggle-btn').onclick = () => {
      const p = document.getElementById('admin-panel');
      p.style.display = p.style.display === 'flex' ? 'none' : 'flex';
  };

  auth.onAuthStateChanged(user => {
      if (user) {
          document.getElementById('user-info-display').innerText = `OPERADOR: ${user.email}`;
      } else { window.location.href = 'index.html'; }
  });
</script>
</body>
</html>