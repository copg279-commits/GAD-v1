<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decodificador PNC Ruso</title>
    <link rel="stylesheet" href="styles.css">
    
    <script type="text/javascript" src="https://unpkg.com/@zxing/library@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
</head>
<body>

    <div class="container">
        <div class="app-header">
            <div class="header-logo-container">
                <img src="../ASSETS/logogad.PNG" alt="Logo GAD" class="header-logo">
            </div>
            <h1>Decodificador PNC Ruso</h1>
            <div class="header-logo-container">
                <img src="../ASSETS/t4c.png" alt="Logo T4C" class="header-logo">
            </div>
        </div>
        
        <div id="status">Esperando acci√≥n...</div>

        <div class="controls">
            <button id="startCamera">Usar C√°mara Web</button>
            <button id="stopCamera" class="stop-btn" style="display: none;">Detener C√°mara</button>
            <label class="file-upload-label">
                Subir Imagen para Recortar
                <input type="file" id="fileInput" accept="image/*" style="display: none;">
            </label>
            
            <button id="showAppMenuBtn" style="background-color: #3498db; color: white;">
                üì± Usar App Esc√°ner Externa
            </button>

            <button id="showManualEntryBtn" style="background-color: #9b59b6; color: white; margin-top: 5px;">
                ‚úçÔ∏è Introducir C√≥digo Manualmente
            </button>

            <button id="clearBtn" style="background-color: #e74c3c; color: white; margin-top: 5px;">
                üóëÔ∏è Limpiar B√∫squeda
            </button>
        </div>

        <div id="cropperContainer" class="cropper-container" style="display: none;">
            <div class="img-container">
                <img id="imageToCrop" src="" alt="Imagen a recortar">
            </div>
            <button id="cropAndReadBtn" class="action-btn">‚úÇÔ∏è Confirmar Recorte y Leer</button>
        </div>

        <div class="video-wrapper" id="videoWrapper" style="display: none;">
            <video id="video" autoplay playsinline></video>
            <div class="scanner-guide" id="scannerGuide"></div>
        </div>

        <div id="cameraControls" class="camera-controls" style="display: none;">
            <div class="control-group">
                <label>‚ÜîÔ∏è Ancho del marco:</label>
                <input type="range" id="guideWidth" min="20" max="95" value="80">
            </div>
            <div class="control-group">
                <label>‚ÜïÔ∏è Alto del marco:</label>
                <input type="range" id="guideHeight" min="10" max="95" value="30">
            </div>
            <div class="control-group">
                <label>üîç Zoom de c√°mara:</label>
                <input type="range" id="zoomSlider" min="1" max="4" step="0.1" value="1">
            </div>
            <button id="manualCaptureBtn" class="action-btn" style="margin-top: 10px;">üì∏ Capturar y Leer Manualmente</button>
        </div>

        <div class="result-box" id="resultBox" style="display: none;">
            
            <div class="dl-card-container">
                <div class="dl-card">
                    <div class="dl-header">
                        <div class="dl-rus">RUS</div>
                        <div class="dl-title">–í–û–î–ò–¢–ï–õ–¨–°–ö–û–ï –£–î–û–°–¢–û–í–ï–†–ï–ù–ò–ï</div>
                    </div>
                    <div class="dl-body">
                        <div class="dl-photo">
                            <svg viewBox="0 0 24 24" fill="#666" width="100%" height="100%"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                        </div>
                        <div class="dl-details">
                            <div class="dl-field"><span>1.</span> <strong id="field1"></strong></div>
                            <div class="dl-field"><span>2.</span> <strong id="field2"></strong></div>
                            <div class="dl-field"><span>3.</span> <strong id="field3"></strong></div>
                            <div class="dl-row">
                                <div class="dl-field"><span>4a)</span> <strong id="field4a"></strong></div>
                                <div class="dl-field"><span>4b)</span> <strong id="field4b"></strong></div>
                            </div>
                            <div class="dl-field"><span>4c)</span> <strong id="field4c"></strong></div>
                            <div class="dl-field"><span>5.</span> <strong id="field5"></strong></div>
                            <div class="dl-field"><span>8.</span> <strong id="field8"></strong></div>
                            <div class="dl-field dl-categories"><span>9.</span> <strong id="field9"></strong></div>
                        </div>
                    </div>
                </div>
            </div>

            <h3 style="margin-top: 30px;">Datos t√©cnicos capturados</h3>
            
            <div class="data-label">C√≥digo crudo (Base64):</div>
            <div class="data-content" id="rawOutput">-</div>

            <div class="data-label">Texto Decodificado (UTF-8):</div>
            <div class="data-content" id="decodedOutput">-</div>
            
            <button id="copyBtn" class="copy-btn">Copiar Texto Decodificado</button>
        </div>
    </div>

    <div id="appModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); backdrop-filter: blur(4px);">
        <div style="background-color: #2c2c2c; margin: 25% auto; padding: 20px; border-radius: 12px; width: 90%; max-width: 400px; position: relative; box-shadow: 0 4px 20px rgba(0,0,0,0.9); border: 1px solid #444;">
            <span id="closeAppModal" style="color: #aaa; font-size: 32px; font-weight: bold; cursor: pointer; position: absolute; top: 5px; right: 15px;">&times;</span>
            <h3 style="color: #3498db; margin-bottom: 10px; font-size: 1.2rem; margin-top: 0;">‚öôÔ∏è Elige tu App Esc√°ner</h3>
            <p style="font-size: 0.85rem; color: #bbb; margin-bottom: 15px;">Selecciona "Preguntar cada vez" para buscar entre tus apps instaladas.</p>
            <select id="appSelector" style="width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 8px; background: #1e1e1e; color: white; border: 1px solid #555; font-size: 0.95rem; outline: none;">
                <option value="">Preguntar cada vez (Selector Android)</option>
                <option value="com.github.markusfisch.android.binaryeye">Binary Eye (Recomendada, auto-retorno)</option>
                <option value="com.teacapps.barcodescanner">Esc√°ner QR y Barras (TeaCapps)</option>
                <option value="com.manateeworks.barcodescanners">Barcode Scanner (Manatee)</option>
            </select>
            <a id="nativeAppBtn" href="#" style="display: block; background-color: #2ecc71; color: white; padding: 14px 20px; border-radius: 8px; font-weight: bold; text-align: center; text-decoration: none; width: 100%;">
                üöÄ ABRIR APP AHORA
            </a>
        </div>
    </div>

    <div id="manualModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); backdrop-filter: blur(4px);">
        <div style="background-color: #2c2c2c; margin: 25% auto; padding: 20px; border-radius: 12px; width: 90%; max-width: 400px; position: relative; box-shadow: 0 4px 20px rgba(0,0,0,0.9); border: 1px solid #444;">
            <span id="closeManualModal" style="color: #aaa; font-size: 32px; font-weight: bold; cursor: pointer; position: absolute; top: 5px; right: 15px;">&times;</span>
            <h3 style="color: #9b59b6; margin-bottom: 10px; font-size: 1.2rem; margin-top: 0;">‚úçÔ∏è Decodificar Manualmente</h3>
            <label style="color: #bbb; font-size: 0.85rem;">Pega el c√≥digo Base64 aqu√≠:</label>
            <textarea id="manualInput" placeholder="Ejemplo: JTEwMTgw...=" style="width: 100%; min-height: 100px; background: #1a1a1a; color: white; padding: 10px; margin-top: 8px; border-radius: 8px; border: 1px solid #444; font-family: monospace; resize: vertical; outline: none;"></textarea>
            <button id="manualDecodeBtn" style="background-color: #2ecc71; color: white; border: none; padding: 14px 20px; margin-top: 15px; border-radius: 8px; font-weight: bold; font-size: 1rem; width: 100%; cursor: pointer;">
                ‚úÖ Decodificar Texto
            </button>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>